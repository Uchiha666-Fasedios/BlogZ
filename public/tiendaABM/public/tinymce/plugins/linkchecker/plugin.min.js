/* Ephox link checker plugin
 *
 * Copyright 2010-2017 Ephox Corporation.  All rights reserved.
 *
 * Version: 2.0.3-92
 */

!function(s){"use strict";var n,t,r,e,o,p=function(n){var t=n,r=function(){return t};return{get:r,set:function(n){t=n},clone:function(){return p(r())}}},u=function(n){return parseInt(n,10)},i=function(n,t,r){return{major:n,minor:t,patch:r}},c=function(n){var t=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(n);return t?i(u(t[1]),u(t[2]),u(t[3])):i(0,0,0)},a=function(n,t){var r=n-t;return 0===r?0:0<r?1:-1},d=function(n,t){return!!n&&-1===function(n,t){var r=a(n.major,t.major);if(0!==r)return r;var e=a(n.minor,t.minor);if(0!==e)return e;var o=a(n.patch,t.patch);return 0!==o?o:0}(c([(r=n).majorVersion,r.minorVersion].join(".").split(".").slice(0,3).join(".")),c(t));var r},f=function(e,o){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var r=e.console;r&&o in r&&r[o].apply(r,arguments)}},m={log:f(window,"log"),error:f(window,"error"),warn:f(window,"warm")},l=function(t,r){var e,n;return(n=function(){var n=arguments;clearTimeout(e),e=setTimeout(function(){t.apply(this,n)},r)}).stop=function(){clearTimeout(e)},n},v=function(){},h=function(r,e){return function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return r(e.apply(null,n))}},g=function(n){return function(){return n}},y=function(n){return n},k=g(!1),w=g(!0),b=k,O=w,x=function(){return T},T=(e={fold:function(n,t){return n()},is:b,isSome:b,isNone:O,getOr:r=function(n){return n},getOrThunk:t=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:r,orThunk:t,map:x,ap:x,each:function(){},bind:x,flatten:x,exists:b,forall:O,filter:x,equals:n=function(n){return n.isNone()},equals_:n,toArray:function(){return[]},toString:g("none()")},Object.freeze&&Object.freeze(e),e),E=function(r){var n=function(){return r},t=function(){return o},e=function(n){return n(r)},o={fold:function(n,t){return t(r)},is:function(n){return r===n},isSome:O,isNone:b,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:t,orThunk:t,map:function(n){return E(n(r))},ap:function(n){return n.fold(x,function(n){return E(n(r))})},each:function(n){n(r)},bind:e,flatten:n,exists:e,forall:e,filter:function(n){return n(r)?o:T},equals:function(n){return n.is(r)},equals_:function(n,t){return n.fold(b,function(n){return t(r,n)})},toArray:function(){return[r]},toString:function(){return"some("+r+")"}};return o},A={some:E,none:x,from:function(n){return null==n?T:E(n)}},S=function(t){return function(n){return function(n){if(null===n)return"null";var t=typeof n;return"object"===t&&Array.prototype.isPrototypeOf(n)?"array":"object"===t&&String.prototype.isPrototypeOf(n)?"string":t}(n)===t}},j=S("object"),C=S("array"),D=S("boolean"),N=S("function"),R=Array.prototype.slice,I=void 0===(o=Array.prototype.indexOf)?function(n,t){return _(n,t)}:function(n,t){return o.call(n,t)},M=function(n,t){for(var r=n.length,e=new Array(r),o=0;o<r;o++){var u=n[o];e[o]=t(u,o,n)}return e},L=function(n,t){for(var r=0,e=n.length;r<e;r++){t(n[r],r,n)}},_=function(n,t){for(var r=0,e=n.length;r<e;++r)if(n[r]===t)return r;return-1},F=Array.prototype.push,P=function(n){for(var t=[],r=0,e=n.length;r<e;++r){if(!Array.prototype.isPrototypeOf(n[r]))throw new Error("Arr.flatten item "+r+" was not an array, input: "+n);F.apply(t,n[r])}return t},U=(N(Array.from)&&Array.from,function(n){var r=A.none(),t=[],e=function(n){o()?i(n):t.push(n)},o=function(){return r.isSome()},u=function(n){L(n,i)},i=function(t){r.each(function(n){s.setTimeout(function(){t(n)},0)})};return n(function(n){r=A.some(n),u(t),t=[]}),{get:e,map:function(r){return U(function(t){e(function(n){t(r(n))})})},isReady:o}}),B={nu:U,pure:function(t){return U(function(n){n(t)})}},q=function(t){var n=function(n){var e;t((e=n,function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var r=this;s.setTimeout(function(){e.apply(r,n)},0)}))},r=function(){return B.nu(n)};return{map:function(e){return q(function(r){n(function(n){var t=e(n);r(t)})})},bind:function(r){return q(function(t){n(function(n){r(n).get(t)})})},anonBind:function(r){return q(function(t){n(function(n){r.get(t)})})},toLazy:r,toCached:function(){var t=null;return q(function(n){null===t&&(t=r()),t.get(n)})},get:n}},J={nu:q,pure:function(t){return q(function(n){n(t)})}},V=function(r){return{is:function(n){return r===n},isValue:w,isError:k,getOr:g(r),getOrThunk:g(r),getOrDie:g(r),or:function(n){return V(r)},orThunk:function(n){return V(r)},fold:function(n,t){return t(r)},map:function(n){return V(n(r))},mapError:function(n){return V(r)},each:function(n){n(r)},bind:function(n){return n(r)},exists:function(n){return n(r)},forall:function(n){return n(r)},toOption:function(){return A.some(r)}}},z=function(r){return{is:k,isValue:k,isError:w,getOr:y,getOrThunk:function(n){return n()},getOrDie:function(){return n=String(r),function(){throw new Error(n)}();var n},or:function(n){return n},orThunk:function(n){return n()},fold:function(n,t){return n(r)},map:function(n){return z(r)},mapError:function(n){return z(n(r))},each:v,bind:function(n){return z(r)},exists:k,forall:w,toOption:A.none}},H={value:V,error:z,fromOption:function(n,t){return n.fold(function(){return z(t)},V)}},W={pure:h(J.pure,H.value),failed:h(J.pure,H.error),foldSync:function(n,t,r){return n.map(function(n){return n.fold(t,r)})},bindSync:function(n,t){return n.map(function(n){return n.bind(t)})},bindAsync:function(n,t){return n.bind(function(n){return n.bind(t)})},mapSync:function(n,t){return n.map(function(n){return n.map(t)})},handle:function(n,t,r){return n.get(function(n){return n.fold(t,r)})}},$=Object.keys,Y=Object.hasOwnProperty,K=function(n,t){for(var r=$(n),e=0,o=r.length;e<o;e++){var u=r[e];t(n[u],u,n)}},X=function(n,e){return G(n,function(n,t,r){return{k:t,v:e(n,t,r)}})},G=function(e,o){var u={};return K(e,function(n,t){var r=o(n,t,e);u[r.k]=r.v}),u},Q=function(i){if(!C(i))throw new Error("cases must be an array");if(0===i.length)throw new Error("there must be at least one case");var c=[],r={};return L(i,function(n,e){var t=$(n);if(1!==t.length)throw new Error("one and only one name per case");var o=t[0],u=n[o];if(void 0!==r[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!C(u))throw new Error("case arguments must be an array");c.push(o),r[o]=function(){var n=arguments.length;if(n!==u.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+u.length+" ("+u+"), got "+n);for(var r=new Array(n),t=0;t<r.length;t++)r[t]=arguments[t];return{fold:function(){if(arguments.length!==i.length)throw new Error("Wrong number of arguments to fold. Expected "+i.length+", got "+arguments.length);return arguments[e].apply(null,r)},match:function(n){var t=$(n);if(c.length!==t.length)throw new Error("Wrong number of arguments to match. Expected: "+c.join(",")+"\nActual: "+t.join(","));if(!function(n,t){for(var r=0,e=n.length;r<e;++r)if(!0!==t(n[r],r,n))return!1;return!0}(c,function(n){return-1<I(t,n)}))throw new Error("Not all branches were specified when using match. Specified: "+t.join(", ")+"\nRequired: "+c.join(", "));return n[o].apply(null,r)},log:function(n){s.console.log(n,{constructors:c,constructor:o,params:r})}}}}),r},Z=Q([{invalid:["invalidUrl"]},{unknown:["unknownUrl"]},{valid:["validUrl"]}]),nn=function(n,t,r,e){return n.fold(t,r,e)},tn=function(n,t){return"VALID"===t?Z.valid(n):"INVALID"===t?Z.invalid(n):Z.unknown(n)},rn=function(n){return n&&/^https?:\/\//.test(n)},en=function(n){return 0===n.indexOf("mailto:")||"#"===n.charAt(0)},on=function(n){return/^\w+:/.test(n)},un=tinymce.DOM,cn=tinymce.util.Tools,an="data-mce-linkchecker-status",fn="data-mce-linkchecker-focus",ln=function(n,t){un.setAttrib(n,an,t),mn(n)&&un.setAttrib(n,"aria-invalid",!0)},sn=function(n){return{url:n}},pn=function(t,n){return cn.map(n,function(n){return{url:t(sn(un.getAttrib(n,"href"))).url,elm:n}})},dn=function(n,t){return cn.grep(n,function(n){return n.url===t})},mn=function(n){return"invalid"===un.getAttrib(n,an)},vn=function(t){return function(n){cn.each(n,function(n){n.attr(t,null)})}},hn={links:function(n){var t=un.select('a[href]:not([href=""])',n);return cn.map(t,function(n){return sn(un.getAttrib(n,"href"))})},mark:ln,unmark:function(n){ln(n,"ignored")},highlight:function(n,t,r){var e=pn(t,un.select("a[href]",n));cn.each(r,function(n,t){cn.each(dn(e,t),function(t){nn(n.result,function(n){ln(t.elm,"invalid")},function(n){ln(t.elm,"unknown")},function(n){ln(t.elm,"valid")})})})},markUnknownLinks:function(n,t,r){var e=pn(t,un.select("a[href]",n));cn.each(r,function(n){cn.each(dn(e,n.url),function(n){ln(n.elm,"unknown")})})},isInvalid:mn,toggleFocus:function(n,t){return un.setAttrib(n,fn,t?"true":null)},registerAttrs:function(n){n.addTempAttr(an),n.addTempAttr(fn),n.addAttributeFilter(an,vn(an)),n.addAttributeFilter(fn,vn(an))},normalizer:function(c){return function(n){var t,r,e,o=n.url.trim(),u=!1===rn(t=o)&&on(t)?o:c.documentBaseURI.toAbsolute(o),i=(0===u.indexOf("//")?location.protocol+u:u).replace(/ /g,"%20");return sn((r=i,(e=document.createElement("a")).href=r,rn(r)?e.href:r))}}},gn=function(n){return function(){n.execCommand("mceLink")}},yn=function(n,t){return function(){!function(n){if(!tinymce.Env.ie||10<tinymce.Env.ie){var t=document.createElement("a");t.target="_blank",t.href=n,t.rel="noreferrer noopener";var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,!0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}else{var e=window.open("","_blank");if(e){e.opener=null;var o=e.document;o.open(),o.write('<meta http-equiv="refresh" content="0; url='+tinymce.DOM.encode(n)+'">'),o.close()}}}(hn.normalizer(n)({url:tinymce.DOM.getAttrib(t,"href")}).url)}},kn=function(n,t){return function(){n.undoManager.transact(function(){tinymce.DOM.remove(t,!0)})}},wn=function(n,t){return function(){n.add(t.href),hn.unmark(t)}},bn=tinymce.DOM,On=function(n,t,r){var e,o,u,i,c,a,f,l=new tinymce.ui.Factory.create("menu",{items:[(e=n,e.plugins.link?{text:"Link",icon:"link",onclick:gn(e)}:null),{text:"Open link",icon:"newtab",onclick:yn(n,t)},{text:"Remove link",icon:"unlink",onclick:kn(n,t)},{text:"-"},{text:"Ignore",onclick:wn(r,t)}],context:"contextmenu",onhide:function(){l.remove(),hn.toggleFocus(t,!1)}});l.renderTo(document.body),o=n,u=l,i=t,c=bn.getPos(o.getContentAreaContainer()),a=o.dom.getPos(i),"BODY"===(f=o.dom.getRoot()).nodeName?(a.x-=f.ownerDocument.documentElement.scrollLeft||f.scrollLeft,a.y-=f.ownerDocument.documentElement.scrollTop||f.scrollTop):(a.x-=f.scrollLeft,a.y-=f.scrollTop),c.x+=a.x,c.y+=a.y,u.moveTo(c.x,c.y+i.offsetHeight+1),hn.toggleFocus(t,!0)},xn=function(n,t){var r,e;n.on("contextmenu",(r=n,e=t,function(n){var t=r.dom.getParent(n.target,"a[href]");hn.isInvalid(t)&&(n.preventDefault(),n.stopImmediatePropagation(),On(r,t,e))}),!0)},Tn=function(n,t,r){return[{text:"Ignore",onAction:wn(r,t)}]},En=function(n,t,r){var e,o=function(n,t){for(var r=[],e=0,o=n.length;e<o;e++){var u=n[e];t(u,e,n)&&r.push(u)}return r}(n.getParam("contextmenu","").split(" "),function(n){return""!==n});if(0!==o.length&&-1===o.indexOf("link")){var u=[{text:"Remove link",icon:"unlink",onAction:kn(n,r)},{text:"Open link",icon:"new-tab",onAction:yn(n,r)},{type:"separator"}];return(e=n,e.plugins.link?[{text:"Link...",icon:"link",onAction:gn(e)}]:[]).concat(u).concat(Tn(0,r,t))}return Tn(0,r,t)},An=function(r,e){r.ui.registry.addContextMenu("linkchecker",{update:function(n){var t=r.dom.getParent(n,"a[href]");return hn.isInvalid(t)?En(r,e,t):[]}})},Sn=tinymce.util.Tools,jn=function(n,t){return Sn.grep(n,function(n){return!1===t.has(n.url)})},Cn=function(t){return function(n){return rn(n.url)===t}},Dn=function(n,t,r,e,o){var u,i=Sn.grep(Sn.map(hn.links(o),r),Cn(!1)),c=jn((u=i,Sn.grep(u,function(n){return!1===en(n.url)})),t);hn.markUnknownLinks(o,r,c)},Nn=function(n,t,r,e,o){var u,i,c,a,f,l,s,p=o.getBody();u=n,i=t,c=r,a=e,f=p,l=Sn.grep(Sn.map(hn.links(f),c),Cn(!0)),s=u.checkMany(jn(l,i)),W.handle(s,function(n){a.logError(n)},function(n){hn.highlight(f,c,n)}),Dn(0,t,r,0,p)},Rn=function(n,t,r,e,o,u,i){var c,a,f=l(Nn,500);hn.registerAttrs(n.serializer),n.dom.loadCSS((c=n.settings,a=u,c.linkchecker_content_css||a+"/content.min.css")),n.on("change setContent undo redo",function(){f(e,t,r,o,n,i)}),Nn(e,t,r,o,n),i?An(n,t):xn(n,t)},In=function(n,t){return function(){return{status:n,message:t}}},Mn=In("invalid","URL does not seem to be valid"),Ln=In("none",""),_n=In("valid","The URL seems to be valid"),Fn=function(n,e,t){var o,u,i=l((o=n,u=t,function(n,t){var r=u.checkOne(n.url,o);W.handle(r,function(n){t({status:"none",message:""})},function(n){nn(n.result,function(n){t(Mn())},function(n){t(Ln())},function(n){t(_n())})})}),500);return function(n,t){var r=e({url:n.url});0===n.url.length||!rn(r.url)&&en(r.url)?t(_n()):rn(r.url)?i(r,t):t(Ln())}},Pn=function(n,t,r,e){"filepicker_validator_handler"in n==0&&(n.filepicker_validator_handler=Fn(t,r,e))};var Un=function(e){return function(n){return t=n,r=e,Y.call(t,r)?A.from(n[e]):A.none();var t,r}},Bn=function(n,t){return Un(t)(n)},qn=function(n,t){var r={};return r[n]=t,r},Jn=(Q([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),Object.prototype.hasOwnProperty),Vn=function(i){return function(){for(var n=new Array(arguments.length),t=0;t<n.length;t++)n[t]=arguments[t];if(0===n.length)throw new Error("Can't merge zero objects");for(var r={},e=0;e<n.length;e++){var o=n[e];for(var u in o)Jn.call(o,u)&&(r[u]=i(r[u],o[u]))}return r}},zn=Vn(function(n,t){return j(n)&&j(t)?zn(n,t):t}),Hn=Vn(function(n,t){return t}),Wn=function(n,t){return r=t,e={},L(n,function(n){var t=n[r];e[t]=n}),e;var r,e},$n=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(t.length!==r.length)throw new Error('Wrong number of arguments to struct. Expected "['+t.length+']", got '+r.length+" arguments");var e={};return L(t,function(n,t){e[n]=g(r[t])}),e}},Yn={now:function(){return(new Date).getTime()}},Kn=36e5;var Xn,Gn,Qn=Q([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),Zn=Qn.strict;(Gn=Xn||(Xn={}))[Gn.Error=0]="Error",Gn[Gn.Value=1]="Value";var nt,tt,rt,et=function(n,t,r){return n.stype===Xn.Error?t(n.serror):r(n.svalue)},ot=function(n){return{stype:Xn.Value,svalue:n}},ut=function(n){return{stype:Xn.Error,serror:n}},it=function(n){return et(n,H.error,H.value)},ct=ot,at=function(n){var t=[],r=[];return L(n,function(n){et(n,function(n){return r.push(n)},function(n){return t.push(n)})}),{values:t,errors:r}},ft=ut,lt=function(n,t){return n.stype===Xn.Value?t(n.svalue):n},st=function(n,t){return n.stype===Xn.Error?t(n.serror):n},pt=function(n,t){return n.stype===Xn.Value?{stype:Xn.Value,svalue:t(n.svalue)}:n},dt=function(n,t){return n.stype===Xn.Error?{stype:Xn.Error,serror:t(n.serror)}:n},mt=function(n){return h(ft,P)(n)},vt=function(n,t){var r,e,o=at(n);return 0<o.errors.length?mt(o.errors):(r=o.values,e=t,0<r.length?ct(zn(e,Hn.apply(void 0,r))):ct(e))},ht=function(n){var t=at(n);return 0<t.errors.length?mt(t.errors):ct(t.values)},gt=Q([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),yt=Q([{field:["name","presence","type"]},{state:["name"]}]),kt=void 0!==s.window?s.window:Function("return this;")(),wt=function(n,t){return function(n,t){for(var r=null!=t?t:kt,e=0;e<n.length&&null!=r;++e)r=r[n[e]];return r}(n.split("."),t)},bt=function(n,t){var r=wt(n,t);if(null==r)throw n+" not available on this browser";return r},Ot=function(){return bt("JSON")},xt=function(n,t,r){return Ot().stringify(n,t,r)},Tt=function(n){return j(n)&&100<$(n).length?" removed due to size":xt(n,null,2)},Et=function(n,t){return ft([{path:n,getErrorInfo:t}])},At=Q([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),St=function(r,e,o){return Bn(e,o).fold(function(){return n=o,t=e,Et(r,function(){return'Could not find valid *strict* value for "'+n+'" in '+Tt(t)});var n,t},ct)},jt=function(n,t,r){var e=Bn(n,t).fold(function(){return r(n)},y);return ct(e)},Ct=function(c,a,n,f){return n.fold(function(o,r,n,e){var u=function(n){var t=e.extract(c.concat([o]),f,n);return pt(t,function(n){return qn(r,f(n))})},i=function(n){return n.fold(function(){var n=qn(r,f(A.none()));return ct(n)},function(n){var t=e.extract(c.concat([o]),f,n);return pt(t,function(n){return qn(r,f(A.some(n)))})})};return n.fold(function(){return lt(St(c,a,o),u)},function(n){return lt(jt(a,o,n),u)},function(){return lt(ct(Bn(a,o)),i)},function(n){return lt((r=n,e=Bn(t=a,o).map(function(n){return!0===n?r(t):n}),ct(e)),i);var t,r,e},function(n){var t=n(a),r=pt(jt(a,o,g({})),function(n){return zn(t,n)});return lt(r,u)})},function(n,t){var r=t(a);return ct(qn(n,f(r)))})},Dt=function(c){return{extract:function(n,t,r){return e=n,o=r,u=t,i=M(c,function(n){return Ct(e,o,n,u)}),vt(i,{});var e,o,u,i},toString:function(){return"obj{\n"+M(c,function(n){return n.fold(function(n,t,r,e){return n+" -> "+e.toString()},function(n,t){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return gt.objOf(M(c,function(n){return n.fold(function(n,t,r,e){return yt.field(n,r,e)},function(n,t){return yt.state(n)})}))}}},Nt=g((nt=ct,{extract:function(r,n,t){return st(nt(t,n),function(n){return t=n,Et(r,function(){return t});var t})},toString:function(){return"val"},toDsl:function(){return gt.itemOf(nt)}})),Rt=h(function(o){return{extract:function(r,e,n){var t=M(n,function(n,t){return o.extract(r.concat(["["+t+"]"]),e,n)});return ht(t)},toString:function(){return"array("+o.toString()+")"},toDsl:function(){return gt.arrOf(o)}}},Dt),It=At.field,Mt=function(n,t,r){return it((e=n,o=y,u=r,i=t.extract([e],o,u),dt(i,function(n){return{input:u,errors:n}})));var e,o,u,i},Lt=function(n,t,r){return Mt(n,t,r).fold(function(n){throw new Error(_t(n))},y)},_t=function(n){return"Errors: \n"+(t=n.errors,r=10<t.length?t.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):t,M(r,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))+"\n\nInput object: "+Tt(n.input);var t,r},Ft=function(){return(Ft=Object.assign||function(n){for(var t,r=1,e=arguments.length;r<e;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},Pt=function(u){return Ft({},u,{toCached:function(){return Pt(u.toCached())},bindFuture:function(t){return Pt(u.bind(function(n){return n.fold(function(n){return J.pure(H.error(n))},function(n){return t(n)})}))},bindResult:function(t){return Pt(u.map(function(n){return n.bind(t)}))},mapResult:function(t){return Pt(u.map(function(n){return n.map(t)}))},mapError:function(t){return Pt(u.map(function(n){return n.mapError(t)}))},foldResult:function(t,r){return u.map(function(n){return n.fold(t,r)})},withTimeout:function(n,o){return Pt(J.nu(function(t){var r=!1,e=s.setTimeout(function(){r=!0,t(H.error(o()))},n);u.get(function(n){r||(s.clearTimeout(e),t(n))})}))}})},Ut=function(n){return Pt(J.nu(n))},Bt=function(n){return Pt(J.pure(H.value(n)))},qt=Ut,Jt=Bt,Vt=function(n){return Pt(J.pure(H.error(n)))},zt=function(n){try{var t=JSON.parse(n);return H.value(t)}catch(n){return H.error("Response was not JSON.")}};(rt=tt||(tt={})).JSON="json",rt.Blob="blob",rt.Text="text",rt.FormData="formdata",rt.MultipartFormData="multipart/form-data";var Ht,Wt,$t,Yt,Kt,Xt=function(t){return J.nu(function(r){var n=new s.FileReader;n.onload=function(n){var t=n.target?n.target.result:new s.Blob([]);r(t)},n.readAsText(t)})},Gt=function(n){return J.pure(n.response)},Qt=function(n,t){switch(n){case tt.JSON:return zt(t.response).fold(function(){return Gt(t)},J.pure);case tt.Blob:return r=t,A.from(r.response).map(Xt).getOr(J.pure("no response content"));case tt.Text:default:return Gt(t)}var r},Zt=function(i,n){return n.map(function(n){var r,e,t,o=(r=function(n,t){return encodeURIComponent(t)+"="+encodeURIComponent(n)},e=[],K(n,function(n,t){e.push(r(n,t))}),e),u=(t="?",-1!==i.indexOf(t)?"&":"?");return 0<o.length?i+u+o.join("&"):i}).getOr(i)},nr=function(n){var t,r=(t=n.body,A.from(t).bind(function(n){switch(n.type){case tt.JSON:return A.some("application/json");case tt.FormData:return A.some("application/x-www-form-urlencoded; charset=UTF-8");case tt.MultipartFormData:return A.none();case tt.Text:default:return A.some("text/plain")}})),e=!0===n.credentials?A.some(!0):A.none(),o=function(n){switch(n){case tt.Blob:return"application/octet-stream";case tt.JSON:return"application/json, text/javascript";case tt.Text:return"text/plain";default:return""}}(n.responseType)+", */*; q=0.01",u=void 0!==n.headers?n.headers:{};return{contentType:r,responseType:function(n){switch(n){case tt.JSON:return A.none();case tt.Blob:return A.some("blob");case tt.Text:return A.some("text");default:return A.none()}}(n.responseType),credentials:e,accept:o,headers:u,progress:N(n.progress)?A.some(n.progress):A.none()}},tr=function(n){var r=new s.FormData;return K(n,function(n,t){r.append(t,n)}),r},rr=function(c){return qt(function(o){var u=new s.XMLHttpRequest;u.open(c.method,Zt(c.url,A.from(c.query)),!0);var r,n,t=nr(c);r=u,(n=t).contentType.each(function(n){return r.setRequestHeader("Content-Type",n)}),r.setRequestHeader("Accept",n.accept),n.credentials.each(function(n){return r.withCredentials=n}),n.responseType.each(function(n){return r.responseType=n}),n.progress.each(function(t){return r.upload.addEventListener("progress",function(n){return t(n.loaded,n.total)})}),K(n.headers,function(n,t){return r.setRequestHeader(t,n)});var e,i=function(){var t,n,r;(t=c.url,n=c.responseType,r=u,Qt(n,r).map(function(n){return{message:0===r.status?"Unknown HTTP error (possible cross-domain request)":"Could not load url "+t+": "+r.statusText,status:r.status,responseText:n}})).get(function(n){return o(H.error(n))})};u.onerror=i,u.onload=function(){var n,t,r,e;0===u.status&&(n=c.url,t=n,e=0,""!=(r="file:")&&(t.length<r.length||t.substr(e,e+r.length)!==r))?i():u.status<100||400<=u.status?i():function(n,t){var r=function(){return Jt(t.response)},e=function(n){return Vt({message:n,status:t.status,responseText:t.responseText})};switch(n){case tt.JSON:return zt(t.response).fold(e,Jt);case tt.Blob:case tt.Text:return r();default:return e("unknown data type")}}(c.responseType,u).get(o)},(e=c.body,A.from(e).map(function(n){return n.type===tt.JSON?JSON.stringify(n.data):n.type===tt.FormData?tr(n.data):n.type===tt.MultipartFormData?tr(n.data):n})).fold(function(){return u.send()},function(n){u.send(n)})})},er=function(){return n="",{type:tt.Text,data:n};var n},or=function(n,t){var r=-1===n.indexOf("?")?"?":"&";return t?n+r+"apiKey="+encodeURIComponent(t):n},ur=function(n){return n.hasOwnProperty("tiny-api-key")?n["tiny-api-key"]:n.hasOwnProperty("tinymce-api-key")?n["tinymce-api-key"]:n["textbox-api-key"]},ir=function(n){return n.fold(function(n){var t=n.responseText,r=j(t)?t:n.message;return H.error(r)},H.value)},cr=function(i,c,a,f){var l=ur(f);return{execute:function(n){var o,t,r=Lt(i+".ajax.service.get",c,n),e=X(r,function(n){return D(n)?String(n):n}),u=or((o=e,a.replace(/\$\{([^{}]*)\}/g,function(n,t){var r,e=o[t];return"string"==(r=typeof e)||"number"===r?e.toString():n})),l);return(t={url:u,responseType:tt.JSON,credentials:!0,headers:f},rr(Ft({},t,{method:"get",body:er()}))).map(ir)}}},ar=function(o,u,i,c){var a=ur(c);return{execute:function(n){var t,r,e=Lt(o+".ajax.service.post",u,n);return(t={url:or(i,a),body:(r=e,{type:tt.JSON,data:r}),responseType:tt.JSON,credentials:!0,headers:c},rr(Ft({},t,{method:"post"}))).map(ir)}}},fr=function(t,o,n,u,r){return!0===r?{known:{},unknown:n}:(e=function(r,n){var e=u(n);return t(o,e).fold(function(){return{known:r.known,unknown:r.unknown.concat([n])}},function(n){var t=qn(e,n);return{known:Hn(r.known,t),unknown:r.unknown}})},i={known:{},unknown:[]},L(n,function(n){i=e(i,n)}),i);var e,i},lr=function(n,t,r,e,o){return(!0===o?A.none():t.get(e,r)).fold(function(){return n(r,o).map(function(n){return n.map(function(n){return t.set(r,n,e),n})})},function(n){return W.pure(n)})},sr=function(n,t,r,e,o,u,i){var c,a,f,l,s,p,d,m=fr(t.get,u,r,o,i);return 0===m.unknown.length?W.pure(m.known):(c=n,a=t,f=m.known,l=m.unknown,s=e,p=u,d=c(l,i),W.mapSync(d,function(n){var t=s(n);return K(t,function(n,t){a.set(t,n,p)}),zn(f,t)}))},pr=[(Yt="url",It(Yt,Yt,Zn(),Nt())),(Ht="fresh",Wt=!1,It(Ht,Ht,($t=Wt,Qn.defaultedThunk(g($t))),Nt()))],dr=Dt(pr),mr=Dt([It("urls","urls",Zn(),(Kt=pr,Rt(Kt)))]),vr={one:g(dr),many:g(mr)};function hr(n,t,r){var e,o,u,i,c,a,f,l,s=(e=r,c=void 0!==o?o:Kn,a=$n("result","timestamp"),f={},l=function(n,t,r){f[n]=a(t,r)},j(e)&&(u=e,i=Yn.now(),X(u,function(n,t){i-n.timestamp<c&&l(t,n.result,n.timestamp)})),{set:l,get:function(t,n){return A.from(f[n]).filter(function(n){return t-n.timestamp()<c}).map(function(n){return n.result()})},dump:function(){return X(f,function(n){return{result:n.result(),timestamp:n.timestamp()}})}}),p=cr("ephox.link.service.one",vr.one(),n+"/1/check?url=${url}&fresh=${fresh}",t),d=ar("ephox.link.service.many",vr.many(),n+"/1/check",t),m=function(n){return{url:n.url,result:tn(n.url,n.result)}};return{checkOne:function(r,n){var t=Yn.now(),e=lr(function(n,t){return p.execute({url:encodeURIComponent(r),fresh:t})},s,r,t,void 0!==n&&n);return W.mapSync(e,m)},checkMany:function(n,t){var r=Yn.now(),e=sr(function(n,t){return d.execute({urls:n})},s,n,function(n){return Wn(n.results,"url")},function(n){return n.url},r,void 0!==t&&t);return W.mapSync(e,function(n){return X(n,m)})},dumpCache:s.dump}}var gr=function(n){var t,r,e,o,u=(t=n.linkchecker_service_url,o=(e=n).api_key,r=o||e.linkchecker_api_key,hr(t,r?{"tinymce-api-key":r}:{}));return{checkOne:function(n){return u.checkOne(n)},checkMany:function(n){return u.checkMany(n)}}},yr=function(n,t){var r=t.getBoundingClientRect(),e=n.inline?{top:0,left:0}:n.getContentAreaContainer().getBoundingClientRect(),o=n.dom.getViewPort();return{top:r.top+e.top+o.y-r.height,center:r.left+e.left+o.x+r.width/2}},kr=function(){var l,s=function(){void 0!==l&&(l.parentNode.removeChild(l),l=void 0)};return{add:function(n,t){s();var r,e,o=yr(n,t);r="This link seems to be invalid.",(e=document.createElement("div")).className="mce-widget mce-tooltip mce-tooltip-s",e.setAttribute("role","presentation"),e.innerHTML='<div class="mce-tooltip-arrow"></div><div style="white-space:pre;" class="mce-tooltip-inner">'+r+"</div>",l=e,document.body.appendChild(l);var u=l.getBoundingClientRect(),i=n.getBody().getBoundingClientRect(),c=o.top-u.height/2,a=o.center-u.width/2;a<=0?(l.className="mce-widget mce-tooltip mce-tooltip-sw",a=o.center):o.center+u.width/2-20>i.width&&(l.className="mce-widget mce-tooltip mce-tooltip-se",a=o.center-u.width);var f="position:absolute;top:"+c+"px;left:"+a+"px;";l.setAttribute("style",f)},remove:s}},wr=function(a,n){var f=kr();a.on("mouseover mouseout",function(n){var t,r,e,o,u,i=n.target,c="mouseover"===n.type;t=f,e=i,o=c,u=(r=a).dom.getParent(e,"a[href]"),hn.isInvalid(u)&&!0===o?t.add(r,u):t.remove()}),a.on("remove",function(){f.remove()})},br=function(n,t){if(d(tinymce,"4.4.3"))return m.error('The "linkchecker" plugin requires at least 4.4.3 version of TinyMCE.'),function(){};var r,o,u,e=!d(tinymce,"5.0.0"),i=p(0),c=gr(n.settings),a=(r={},{add:function(n){r[n]=!0},has:function(n){return n in r}}),f=hn.normalizer(n),l=(o=n,u=i,{logError:function(n){var t,r,e="string"==typeof(t=n)?{message:t}:t;r=e,o.fire("LinkCheckerError",r),u.set(u.get()+1),u.get()<5&&!o.removed&&s.console.error("Link checker error: "+e.message)}});return n.on("SkinLoaded",function(){"string"!=typeof n.settings.linkchecker_service_url?l.logError("You need to specify the linkchecker_service_url setting"):(Rn(n,a,f,c,l,t,e),Pn(n.settings,a,f,c))}),e||wr(n),{}};tinymce.PluginManager.add("linkchecker",br)}(window);